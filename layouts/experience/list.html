{{ define "main" }}
  <article class="prose dark:prose-invert max-w-none">
    <h1>{{ .Title }}</h1>
    {{ with .Content }}<div class="mb-8">{{ . }}</div>{{ end }}

    {{/* Conditionally render child pages if hideChildren not set/true */}}
    {{ if not (.Params.hideChildren | default false) }}
      {{/* Collect pages and group by company param in front matter */}}
      {{ $pages := where .Pages "Kind" "page" }}
      {{ if gt (len $pages) 0 }}
        {{ $groups := dict }}
        {{ range $p := $pages }}
          {{ $company := $p.Params.company | default "Other" }}
          {{ $existing := index $groups $company }}
          {{ if $existing }}
            {{ $groups = merge $groups (dict $company ( $existing | append $p )) }}
          {{ else }}
            {{ $groups = merge $groups (dict $company ( slice $p )) }}
          {{ end }}
        {{ end }}

        {{/* Sort company names alphabetically (optionally move Ford first) */}}
        {{ $companyNames := slice }}
        {{ range $k, $_ := $groups }}
          {{ $companyNames = $companyNames | append $k }}
        {{ end }}
        {{ $companyNames = sort $companyNames }}
        {{ if in $companyNames "Ford Motor Company" }}
          {{ $reordered := slice "Ford Motor Company" }}
          {{ range $n := $companyNames }}
            {{ if ne $n "Ford Motor Company" }}
              {{ $reordered = $reordered | append $n }}
            {{ end }}
          {{ end }}
          {{ $companyNames = $reordered }}
        {{ end }}

        {{ range $c := $companyNames }}
          <section class="mb-12">
            <h2 class="mt-0">{{ $c }}</h2>
            {{ $entries := index $groups $c }}
            {{ range $e := $entries }}
              <div class="mb-6">
                <h3 class="mb-1 text-lg font-semibold">{{ $e.Title }}</h3>
                {{ with $e.Content }}
                  {{ $split := split . "### Highlights" }}
                  <div class="text-sm leading-relaxed">{{ index $split 0 | safeHTML }}</div>
                {{ end }}
                <a class="text-primary-600 dark:text-primary-400 text-sm" href="{{ $e.RelPermalink }}">Full details â†’</a>
              </div>
            {{ end }}
          </section>
        {{ end }}
      {{ end }}
    {{ end }}
  </article>
{{ end }}
